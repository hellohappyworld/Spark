```
----------------------------------------------------------------------------------------------
---练习01(Spark集群启动和任务提交)
----------------------------------------------------------------------------------------------
Spark集群启动流程：
1.调用start-all.sh，首先启动Master服务(进程)
2.start-all.sh会找到slaves配置文件，遍历出需要在哪些节点上启动Worker，然后在这些节点上开始启动Worker
3.Worker进程启动后，再调用生命周期方法开始向Master进行注册
4.Master接收到Worker的注册信息，把WorkerInfo保存到内存和磁盘(调用持久化引擎),Master向Worker响应注册成功的信息,
  (其实就是把MasterURL发送给Worker)
5.Worker接收到Master发送过来的url并进行更新，开始向Master建立心跳
6.Master不断的接收到Worker发送过来的心跳信息(WorkerId),Master不断的更新Worker的最后的一次心跳信息


Spark任务提交流程：
$Spark/bin/spark-submit \
--calss com.tencent.day08.SparkWC \
--master spark://min1:7077 \
--executor-memory 512m \
--total-executor-cores 2 \
/sparkDate/1.jar \
args....(指定args需要的参数)

1.Driver端启动SparkSubmit进程，SparkSubmit进程开始向Master进行通信，其实就是发送任务信息，在发送任务信息的时候
  创建了一个非常重要的对象(SparkContext)
2.Master接收到任务信息后，把任务信息放在一个队列里，开始获取所有的Worker，然后过滤出没有宕掉的Worker，再进行排序，
  然后把比较空闲的Worker排在前面，最后通知相应的Worker拿任务信息，并启动Executor子进程
3.Executor启动后，开始和Driverdaunt进行反向注册
4.Driver开始把刚才生成的任务发送给相应的Executor
5.Executor接收后，开始执行任务

----------------------------------------------------------------------------------------------
---练习02(SparkWordCount过程中创建的RDD)
----------------------------------------------------------------------------------------------




----------------------------------------------------------------------------------------------
---练习03()
----------------------------------------------------------------------------------------------
package com.tencent.demo02

import org.apache.spark.rdd.RDD
import org.apache.spark.{SparkConf, SparkContext}

/**
  * 需求：在一定时间范围内，求用户(以手机号为唯一标识的)经过所有基站停留的时间最长的前两个基站的纬度和经度和停留时间
  */
object MobileLocation {
  def main(args: Array[String]): Unit = {
    val conf: SparkConf = new SparkConf()
      .setAppName("MobileLocation")
      .setMaster("local[2]")
    val sc: SparkContext = new SparkContext(conf)

    //获取数据
    val file: RDD[String] = sc.textFile("D:\\1千峰资源\\Spark\\day03\\logdata\\log")

    //切分数据
    val phoneAndLacAndTime: RDD[((String, String), Long)] = file.map(line => {
      //以“,”对每行数据进行切分
      val fields: Array[String] = line.split(",")
      //用户的手机号，作为用户的唯一标识
      val phone: String = fields(0)
      //时间戳
      val time: Long = fields(1).toLong
      //基站ID
      val lac: String = fields(2)
      //事件类型，1为进入会话，0为离开会话
      val eventType: Int = fields(3).toInt

      val time_long = if (eventType == 1) -time else time

      //返回的值
      ((phone, lac), time_long)
    })

    //用户在相同的基站停留的时间
    //结果：ArrayBuffer(((18101056888,9F36407EAD8829FC166F14DDE7970F68),54000), ((18688888888,CC0710CC94ECC657A8561DE549D940E0),1300), ((18688888888,16030401EAFB68F1E3CDF819735E1C66),87600), ((18101056888,16030401EAFB68F1E3CDF819735E1C66),97500), ((18688888888,9F36407EAD8829FC166F14DDE7970F68),51200), ((18101056888,CC0710CC94ECC657A8561DE549D940E0),1900))
    val sumedPhoneAndLacAndTime: RDD[((String, String), Long)] = phoneAndLacAndTime.reduceByKey(_ + _)

    //为了方便以后把对应的经纬度信息join进来，需要把上面的数据调整一下：就是把lac作为key
    //结果：ArrayBuffer((9F36407EAD8829FC166F14DDE7970F68,(18101056888,54000)), (CC0710CC94ECC657A8561DE549D940E0,(18688888888,1300)), (16030401EAFB68F1E3CDF819735E1C66,(18688888888,87600)), (16030401EAFB68F1E3CDF819735E1C66,(18101056888,97500)), (9F36407EAD8829FC166F14DDE7970F68,(18688888888,51200)), (CC0710CC94ECC657A8561DE549D940E0,(18101056888,1900)))
    val lacAndPhoneAndTime: RDD[(String, (String, Long))] = sumedPhoneAndLacAndTime.map(line => {
      //手机号
      val phone: String = line._1._1
      //基站ID
      val lac: String = line._1._2
      //用户在该基站停留的总时间
      val time: Long = line._2

      (lac, (phone, time))
    })

    //获取基站对应的经纬度信息
    val lacInfo: RDD[String] = sc.textFile("D:\\1千峰资源\\Spark\\day03\\logdata/lac_info.txt")

    //对基站的信息进行切分
    val lacAndXY: RDD[(String, (String, String))] = lacInfo.map(line => {
      val fields: Array[String] = line.split(",")
      //基站ID
      val lac: String = fields(0)
      //经度
      val x: String = fields(1)
      //纬度
      val y: String = fields(2)

      (lac, (x, y))
    })

    //把经纬度信息join到用户访问基站信息中
    //结果：ArrayBuffer((9F36407EAD8829FC166F14DDE7970F68,((18101056888,54000),(116.304864,40.050645))), (9F36407EAD8829FC166F14DDE7970F68,((18688888888,51200),(116.304864,40.050645))), (CC0710CC94ECC657A8561DE549D940E0,((18688888888,1300),(116.303955,40.041935))), (CC0710CC94ECC657A8561DE549D940E0,((18101056888,1900),(116.303955,40.041935))), (16030401EAFB68F1E3CDF819735E1C66,((18688888888,87600),(116.296302,40.032296))), (16030401EAFB68F1E3CDF819735E1C66,((18101056888,97500),(116.296302,40.032296))))
    val joined: RDD[(String, ((String, Long), (String, String)))] = lacAndPhoneAndTime.join(lacAndXY)

    //重新调整数据，方便接下来以时长进行排序
    //结果：ArrayBuffer((18101056888,54000,(116.304864,40.050645)), (18688888888,51200,(116.304864,40.050645)), (18688888888,1300,(116.303955,40.041935)), (18101056888,1900,(116.303955,40.041935)), (18688888888,87600,(116.296302,40.032296)), (18101056888,97500,(116.296302,40.032296)))
    val phoneAndTimeAndXY: RDD[(String, Long, (String, String))] = joined.map(line => {
      //手机号
      val phone: String = line._2._1._1
      //总时长
      val time: Long = line._2._1._2
      //经纬度
      val xy: (String, String) = line._2._2

      (phone, time, xy)
    })

    //以手机号来进行分组
    //结果：ArrayBuffer((18101056888,CompactBuffer((18101056888,54000,(116.304864,40.050645)), (18101056888,1900,(116.303955,40.041935)), (18101056888,97500,(116.296302,40.032296)))), (18688888888,CompactBuffer((18688888888,51200,(116.304864,40.050645)), (18688888888,1300,(116.303955,40.041935)), (18688888888,87600,(116.296302,40.032296)))))
    val grouped: RDD[(String, Iterable[(String, Long, (String, String))])] = phoneAndTimeAndXY.groupBy(_._1)

    //按照时长进行组内排序(降序)
    //结果：ArrayBuffer((18101056888,List((18101056888,97500,(116.296302,40.032296)), (18101056888,54000,(116.304864,40.050645)), (18101056888,1900,(116.303955,40.041935)))), (18688888888,List((18688888888,87600,(116.296302,40.032296)), (18688888888,51200,(116.304864,40.050645)), (18688888888,1300,(116.303955,40.041935)))))
    val sorted: RDD[(String, List[(String, Long, (String, String))])] = grouped.mapValues(_.toList.sortBy(_._2).reverse)

    println(sorted.collect.toBuffer)

    //获取前两个数据
    //结果：ArrayBuffer((18101056888,List((18101056888,97500,(116.296302,40.032296)), (18101056888,54000,(116.304864,40.050645)))), (18688888888,List((18688888888,87600,(116.296302,40.032296)), (18688888888,51200,(116.304864,40.050645)))))
    val res: RDD[(String, List[(String, Long, (String, String))])] = sorted.mapValues(_.take(2))

    println(res.collect.toBuffer)
    
    sc.stop()
  }
}



----------------------------------------------------------------------------------------------
---练习04()
----------------------------------------------------------------------------------------------
package com.tencent.demo01

import java.net.URL

import org.apache.spark.rdd.RDD
import org.apache.spark.{SparkConf, SparkContext}

/**
  * 统计每个学科的各个模块的访问量，再求top3
  */
object SubjectCount1 {
  def main(args: Array[String]): Unit = {
    val conf = new SparkConf()
      .setAppName("SubjectCount1")
      .setMaster("local")
    val sc=new SparkContext(conf)

    //获取数据
    val file=sc.textFile("D:\\1千峰资源\\Spark\\day03\\logdata/access.txt")

    //切分数据,并返回元组:(url,1) 方便以后进行聚合
    //结果：ArrayBuffer((http://java.learn.com/java/javaee.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://android.learn.com/android/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://android.learn.com/android/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://android.learn.com/android/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://android.learn.com/android/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://android.learn.com/android/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1))
    val tupled: RDD[(String, Int)] = file.map(line => {
      val fields = line.split("\t")
      val url = fields(1)

      (url, 1)
    })

    //将相同的url进行聚合,得到的结果就是相同的学科里的相同的模块的访问量
    //结果：ArrayBuffer((http://ui.learn.com/ui/course.shtml,26), (http://bigdata.learn.com/bigdata/teacher.shtml,46), (http://bigdata.learn.com/bigdata/course.shtml,25), (http://h5.learn.com/h5/course.shtml,47), (http://ui.learn.com/ui/teacher.shtml,23), (http://java.learn.com/java/teacher.shtml,25), (http://ui.learn.com/ui/video.shtml,37), (http://h5.learn.com/h5/video.shtml,11), (http://java.learn.com/java/javaee.shtml,13), (http://bigdata.learn.com/bigdata/video.shtml,47), (http://android.learn.com/android/video.shtml,5), (http://h5.learn.com/h5/teacher.shtml,17), (http://java.learn.com/java/video.shtml,23))
    val sumed: RDD[(String, Int)] = tupled.reduceByKey(_+_)

    //获取学科信息，返回学科，url，访问量:(subject,url,count)
    //结果：ArrayBuffer((ui.learn.com,http://ui.learn.com/ui/course.shtml,26), (bigdata.learn.com,http://bigdata.learn.com/bigdata/teacher.shtml,46), (bigdata.learn.com,http://bigdata.learn.com/bigdata/course.shtml,25), (h5.learn.com,http://h5.learn.com/h5/course.shtml,47), (ui.learn.com,http://ui.learn.com/ui/teacher.shtml,23), (java.learn.com,http://java.learn.com/java/teacher.shtml,25), (ui.learn.com,http://ui.learn.com/ui/video.shtml,37), (h5.learn.com,http://h5.learn.com/h5/video.shtml,11), (java.learn.com,http://java.learn.com/java/javaee.shtml,13), (bigdata.learn.com,http://bigdata.learn.com/bigdata/video.shtml,47), (android.learn.com,http://android.learn.com/android/video.shtml,5), (h5.learn.com,http://h5.learn.com/h5/teacher.shtml,17), (java.learn.com,http://java.learn.com/java/video.shtml,23))
    val subjectAndUrlAndCount: RDD[(String, String, Int)] = sumed.map(x => {
      val url = x._1
      val count = x._2
      val subject = new URL(url).getHost

      (subject, url, count)
    })

    //按照学科信息先分组
    //结果：ArrayBuffer((android.learn.com,CompactBuffer((android.learn.com,http://android.learn.com/android/video.shtml,5))), (ui.learn.com,CompactBuffer((ui.learn.com,http://ui.learn.com/ui/course.shtml,26), (ui.learn.com,http://ui.learn.com/ui/teacher.shtml,23), (ui.learn.com,http://ui.learn.com/ui/video.shtml,37))), (java.learn.com,CompactBuffer((java.learn.com,http://java.learn.com/java/teacher.shtml,25), (java.learn.com,http://java.learn.com/java/javaee.shtml,13), (java.learn.com,http://java.learn.com/java/video.shtml,23))), (h5.learn.com,CompactBuffer((h5.learn.com,http://h5.learn.com/h5/course.shtml,47), (h5.learn.com,http://h5.learn.com/h5/video.shtml,11), (h5.learn.com,http://h5.learn.com/h5/teacher.shtml,17))), (bigdata.learn.com,CompactBuffer((bigdata.learn.com,http://bigdata.learn.com/bigdata/teacher.shtml,46), (bigdata.learn.com,http://bigdata.learn.com/bigdata/course.shtml,25), (bigdata.learn.com,http://bigdata.learn.com/bigdata/video.shtml,47))))
    val grouped: RDD[(String, Iterable[(String, String, Int)])] = subjectAndUrlAndCount.groupBy(_._1)

    //在学科信息组内进行降序排序
    //结果：ArrayBuffer((android.learn.com,List((android.learn.com,http://android.learn.com/android/video.shtml,5))), (ui.learn.com,List((ui.learn.com,http://ui.learn.com/ui/video.shtml,37), (ui.learn.com,http://ui.learn.com/ui/course.shtml,26), (ui.learn.com,http://ui.learn.com/ui/teacher.shtml,23))), (java.learn.com,List((java.learn.com,http://java.learn.com/java/teacher.shtml,25), (java.learn.com,http://java.learn.com/java/video.shtml,23), (java.learn.com,http://java.learn.com/java/javaee.shtml,13))), (h5.learn.com,List((h5.learn.com,http://h5.learn.com/h5/course.shtml,47), (h5.learn.com,http://h5.learn.com/h5/teacher.shtml,17), (h5.learn.com,http://h5.learn.com/h5/video.shtml,11))), (bigdata.learn.com,List((bigdata.learn.com,http://bigdata.learn.com/bigdata/video.shtml,47), (bigdata.learn.com,http://bigdata.learn.com/bigdata/teacher.shtml,46), (bigdata.learn.com,http://bigdata.learn.com/bigdata/course.shtml,25))))
    val sorted: RDD[(String, List[(String, String, Int)])] = grouped.mapValues(_.toList.sortBy(_._3).reverse)

    //获取学科信息组内数量前二的学科信息
    //结果：ArrayBuffer((android.learn.com,List((android.learn.com,http://android.learn.com/android/video.shtml,5))), (ui.learn.com,List((ui.learn.com,http://ui.learn.com/ui/video.shtml,37), (ui.learn.com,http://ui.learn.com/ui/course.shtml,26))), (java.learn.com,List((java.learn.com,http://java.learn.com/java/teacher.shtml,25), (java.learn.com,http://java.learn.com/java/video.shtml,23))), (h5.learn.com,List((h5.learn.com,http://h5.learn.com/h5/course.shtml,47), (h5.learn.com,http://h5.learn.com/h5/teacher.shtml,17))), (bigdata.learn.com,List((bigdata.learn.com,http://bigdata.learn.com/bigdata/video.shtml,47), (bigdata.learn.com,http://bigdata.learn.com/bigdata/teacher.shtml,46))))
    val res: RDD[(String, List[(String, String, Int)])] = sorted.mapValues(_.take(2))

    //调用collect会将数据转换成一个定长数组,,用toBuffer会转化成一个变长数组
    //println(res.collect.toBuffer)
    res.foreach(x => println(x))

    sc.stop()
  }
}



----------------------------------------------------------------------------------------------
---练习05()
----------------------------------------------------------------------------------------------
package com.tencent.demo01

import org.apache.spark.{SparkConf, SparkContext}
import org.apache.spark.rdd.RDD

/**
  * cache的应用
  */
object SubjectCount2 {
  def main(args: Array[String]): Unit = {
    val conf = new SparkConf()
      .setAppName("SubjectCount1")
      .setMaster("local")
    val sc=new SparkContext(conf)

    //获取数据
    val file=sc.textFile("D:\\1千峰资源\\Spark\\day03\\logdata/access.txt")

    //切分数据,并返回元组:(url,1) 方便以后进行聚合
    //结果：ArrayBuffer((http://java.learn.com/java/javaee.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://android.learn.com/android/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://android.learn.com/android/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://android.learn.com/android/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://android.learn.com/android/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://java.learn.com/java/javaee.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://android.learn.com/android/video.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://ui.learn.com/ui/teacher.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://java.learn.com/java/video.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/course.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://h5.learn.com/h5/course.shtml,1), (http://bigdata.learn.com/bigdata/video.shtml,1), (http://java.learn.com/java/teacher.shtml,1), (http://ui.learn.com/ui/video.shtml,1), (http://h5.learn.com/h5/teacher.shtml,1), (http://bigdata.learn.com/bigdata/teacher.shtml,1), (http://ui.learn.com/ui/course.shtml,1), (http://ui.learn.com/ui/course.shtml,1))
    val tupled: RDD[(String, Int)] = file.map(line => {
      val fields = line.split("\t")
      val url = fields(1)

      (url, 1)
    })

    //将相同的url进行聚合,得到的结果就是相同的学科里的相同的模块的访问量
    //结果：ArrayBuffer((http://ui.learn.com/ui/course.shtml,26), (http://bigdata.learn.com/bigdata/teacher.shtml,46), (http://bigdata.learn.com/bigdata/course.shtml,25), (http://h5.learn.com/h5/course.shtml,47), (http://ui.learn.com/ui/teacher.shtml,23), (http://java.learn.com/java/teacher.shtml,25), (http://ui.learn.com/ui/video.shtml,37), (http://h5.learn.com/h5/video.shtml,11), (http://java.learn.com/java/javaee.shtml,13), (http://bigdata.learn.com/bigdata/video.shtml,47), (http://android.learn.com/android/video.shtml,5), (http://h5.learn.com/h5/teacher.shtml,17), (http://java.learn.com/java/video.shtml,23))
    val sumed: RDD[(String, Int)] = tupled.reduceByKey(_+_)

    //在发生shuffle后得到的中间结果数据往往很重要，会经常调用该数据，为了提高调用速度，可以把该数据缓存起来
    //cache会将数据放到内存中存一会
    //注意：cache的数据量特别大的时候会造成整个任务出现内存溢出
    val cached: RDD[(String, Int)] = sumed.cache() //也可以调用persist()

    val subjects=Array("http://bigdata.learn.com","http://ui.learn.com",
      "http://java.learn.com","http://h5.learn.com","http://android.learn.com")


    for (subject <- subjects){
      /**
      * 当然是一个循环filteredSubject得到一行的数据
	ArrayBuffer((http://bigdata.learn.com/bigdata/teacher.shtml,46), (http://bigdata.learn.com/bigdata/course.shtml,25), (http://bigdata.learn.com/bigdata/video.shtml,47))
        ArrayBuffer((http://ui.learn.com/ui/course.shtml,26), (http://ui.learn.com/ui/teacher.shtml,23), (http://ui.learn.com/ui/video.shtml,37))
        ArrayBuffer((http://java.learn.com/java/teacher.shtml,25), (http://java.learn.com/java/javaee.shtml,13), (http://java.learn.com/java/video.shtml,23))
        ArrayBuffer((http://h5.learn.com/h5/course.shtml,47), (http://h5.learn.com/h5/video.shtml,11), (http://h5.learn.com/h5/teacher.shtml,17))
        ArrayBuffer((http://android.learn.com/android/video.shtml,5))
      */		
      val filteredSubject: RDD[(String, Int)] = cached.filter(_._1.startsWith(subject))
      //降序排序
      /**
        * 当然是每循环一次sorted得到一行的数据
        * ArrayBuffer((http://bigdata.learn.com/bigdata/video.shtml,47), (http://bigdata.learn.com/bigdata/teacher.shtml,46), (http://bigdata.learn.com/bigdata/course.shtml,25))
          ArrayBuffer((http://ui.learn.com/ui/video.shtml,37), (http://ui.learn.com/ui/course.shtml,26), (http://ui.learn.com/ui/teacher.shtml,23))
          ArrayBuffer((http://java.learn.com/java/teacher.shtml,25), (http://java.learn.com/java/video.shtml,23), (http://java.learn.com/java/javaee.shtml,13))
          ArrayBuffer((http://h5.learn.com/h5/course.shtml,47), (http://h5.learn.com/h5/teacher.shtml,17), (http://h5.learn.com/h5/video.shtml,11))
          ArrayBuffer((http://android.learn.com/android/video.shtml,5))
        */
      val sorted: RDD[(String, Int)] = filteredSubject.sortBy(_._2,false)

      val res: Array[(String, Int)] = sorted.take(2)
      
      /**
        * 结果：
        * ArrayBuffer((http://bigdata.learn.com/bigdata/video.shtml,47), (http://bigdata.learn.com/bigdata/teacher.shtml,46))
          ArrayBuffer((http://ui.learn.com/ui/video.shtml,37), (http://ui.learn.com/ui/course.shtml,26))
          ArrayBuffer((http://java.learn.com/java/teacher.shtml,25), (http://java.learn.com/java/video.shtml,23))
          ArrayBuffer((http://h5.learn.com/h5/course.shtml,47), (http://h5.learn.com/h5/teacher.shtml,17))
          ArrayBuffer((http://android.learn.com/android/video.shtml,5))
        */		
      println(res.toBuffer)
    }

    sc.stop()
  }
}

```

